# 统一收银台配置说明

## 概述

统一收银台项目位于 `hwdb-frontend/cashier-frontend`，其他前端网站可以通过配置跳转到这个统一的收银台。

## 配置步骤

### 1. 部署统一收银台

首先需要将 `cashier-frontend` 部署到一个独立的域名，例如：
- 开发环境：`http://localhost:5174`
- 生产环境：`https://tpimtoken.com`

### 2. 在其他前端网站中配置

#### 方法一：修改 HomePage.vue（推荐）

找到下单后跳转到收银台的代码，通常是：
```javascript
router.push(`/cashier/${orderSN}`)
```

修改为：
```javascript
// 统一收银台域名（根据实际部署地址修改）
const CASHIER_BASE_URL = 'https://tpimtoken.com'  // 或 'http://localhost:5174' (开发环境)

// 保存订单数据到 sessionStorage
sessionStorage.setItem(`order_${orderSN}`, JSON.stringify(orderData))
sessionStorage.setItem(`website_name_${orderSN}`, shopConfig.value.merchant_name || '好旺担保')

// 跳转到统一收银台
window.location.href = `${CASHIER_BASE_URL}/cashier/${orderSN}`
```

#### 方法二：创建配置文件（更灵活）

1. 创建配置文件 `src/config/cashier.js`：
```javascript
// 统一收银台配置
export const CASHIER_CONFIG = {
  // 开发环境
  // baseUrl: 'http://localhost:5174',
  
  // 生产环境
  baseUrl: 'https://tpimtoken.com',
  
  // 或者使用相对路径（如果部署在同一域名下）
  // baseUrl: '/cashier'
}

export function getCashierUrl(orderSN) {
  return `${CASHIER_CONFIG.baseUrl}/cashier/${orderSN}`
}

export function getPaymentUrl(orderSN, idParam = '', amount = '') {
  const params = new URLSearchParams()
  if (idParam) params.append('id', idParam)
  if (amount) params.append('amount', amount)
  const queryString = params.toString() ? `?${params.toString()}` : ''
  return `${CASHIER_CONFIG.baseUrl}/payment/${orderSN}${queryString}`
}
```

2. 在 HomePage.vue 中使用：
```javascript
import { getCashierUrl } from '@/config/cashier'

// 下单后跳转
const orderSN = 'ORD123456'
sessionStorage.setItem(`order_${orderSN}`, JSON.stringify(orderData))
sessionStorage.setItem(`website_name_${orderSN}`, shopConfig.value.merchant_name || '好旺担保')

window.location.href = getCashierUrl(orderSN)
```

### 3. 需要修改的文件列表

需要修改以下前端网站的跳转逻辑：

- ✅ `shoujikashangcheng/src/views/HomePage.vue`
- ✅ `xiangjishangcheng/src/views/HomePage.vue`
- ✅ `hwdb-frontend/src/views/HomePage.vue`
- ✅ `hwtx-frontend/src/views/HomePage.vue`
- ✅ `qezj-frontend/src/views/HomePage.vue`
- ✅ `guoneizhanghaoshangcheng/src/views/HomePage.vue`
- ✅ `qe-frontend/src/views/HomePage.vue`
- ✅ `sgk-frontend/src/views/HomePage.vue`
- ✅ 其他前端网站的 HomePage.vue

### 4. 数据传递说明

统一收银台通过 `sessionStorage` 获取订单数据：

- **订单数据**：`order_${orderSN}` - 完整的订单对象
- **网站名称**：`website_name_${orderSN}` - 商户名称
- **钱包类型**：`wallet_type_${orderSN}` - 用户选择的钱包类型

### 5. 部署选项

#### 选项A：独立域名部署（推荐）

- 优点：完全独立，不影响其他项目
- 缺点：需要单独域名和部署
- 示例：`https://tpimtoken.com`

#### 选项B：子路径部署

- 优点：使用同一域名，配置简单
- 缺点：需要配置反向代理
- 示例：`https://yourdomain.com/cashier`

#### 选项C：Vercel 部署

1. 在 Vercel 创建新项目
2. 连接 `cashier-frontend` 目录
3. 部署后获得独立域名
4. 在配置文件中使用该域名

## 注意事项

1. **跨域问题**：如果收银台和主站不在同一域名，需要确保：
   - sessionStorage 在同一浏览器会话中共享（同源策略）
   - 如果跨域，考虑使用 URL 参数传递数据

2. **订单数据**：确保在跳转前保存完整的订单数据到 sessionStorage

3. **测试**：修改后务必测试完整的支付流程

## 示例代码

### 完整的跳转代码示例

```javascript
// 在 HomePage.vue 的下单函数中
async function handleSubmit() {
  // ... 创建订单的代码 ...
  
  const orderSN = responseData.order_sn
  const orderData = {
    orderSN: orderSN,
    actual_price: totalAmount,
    id: uniqueId,
    // ... 其他订单数据
  }
  
  // 保存订单数据
  sessionStorage.setItem(`order_${orderSN}`, JSON.stringify(orderData))
  sessionStorage.setItem(`website_name_${orderSN}`, shopConfig.value.merchant_name || '好旺担保')
  
  // 跳转到统一收银台
  const CASHIER_URL = import.meta.env.VITE_CASHIER_URL || 'https://tpimtoken.com'
  window.location.href = `${CASHIER_URL}/cashier/${orderSN}`
}
```

### 环境变量配置（.env）

```bash
# 开发环境
VITE_CASHIER_URL=http://localhost:5174

# 生产环境
VITE_CASHIER_URL=https://tpimtoken.com
```

然后在代码中使用：
```javascript
const CASHIER_URL = import.meta.env.VITE_CASHIER_URL
```

